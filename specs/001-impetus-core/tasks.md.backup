# Tasks: Impetus Lock Core - Agent Intervention System

**Feature Branch**: `001-impetus-core`  
**Input**: Design documents from `/specs/001-impetus-core/`  
**Prerequisites**: plan.md, spec.md, research.md, data-model.md, contracts/intervention.yaml, quickstart.md

**CONSTITUTIONAL REQUIREMENTS**:
- **Article II (Vibe-First)**: P1 priority ONLY for un-deletable constraint tasks (Lock + Muse + Loki); all others P2+
- **Article III (TDD - NON-NEGOTIABLE)**: Test tasks MUST be created for ALL P1 user stories BEFORE implementation tasks
- **Article IV (SOLID)**: Backend tasks must enable SRP (endpoints delegate to services) and DIP (use abstractions)
- **Article V (Documentation)**: All implementation tasks must include JSDoc/Docstring requirements

**Organization**: Tasks are grouped by user story to enable independent implementation and testing of each story.

**Act CLI Validation**: All tasks remain incomplete until `act` (GitHub Actions local simulator) passes all CI workflow checks.

---

## Format: `[ID] [P?] [Story] Description`

- **[P]**: Can run in parallel (different files, no dependencies)
- **[Story]**: Which user story this task belongs to (e.g., US1, US2, US3)
- Include exact file paths in descriptions

---

## Path Conventions

**Monorepo Structure**:
- Backend: `server/server/`, `server/tests/`
- Frontend: `client/src/`, `client/tests/`

---

## Phase 1: Setup (Shared Infrastructure)

**Purpose**: Project initialization and tooling setup

**Note**: Project structure already initialized. This phase focuses on feature-specific dependencies.

- [ ] T001 [P] Install Milkdown editor dependencies in client/package.json (@milkdown/core ^7.x, @milkdown/react, @milkdown/preset-commonmark, @milkdown/plugin-history)
- [ ] T002 [P] Install Instructor library in server/pyproject.toml (instructor ^1.4.0 for strongly-typed LLM outputs)
- [ ] T003 [P] Install Framer Motion in client/package.json (framer-motion ^11.x for P2 animations)
- [ ] T004 [P] Generate TypeScript types from OpenAPI contract using openapi-typescript: `npx openapi-typescript ../specs/001-impetus-core/contracts/intervention.yaml -o client/src/types/api.generated.ts`
- [ ] T005 Configure environment variables: Add OPENAI_API_KEY to server/.env.example and document in quickstart.md
- [ ] T006 [P] Create Act CLI configuration in .actrc for local GitHub Actions simulation (use catthehacker/ubuntu:act-latest image)
- [ ] T007 Verify Act CLI installation and basic workflow: `act -l` to list available jobs

**Checkpoint**: Dependencies installed, type generation working, Act CLI configured

---

## Phase 2: Foundational (Blocking Prerequisites)

**Purpose**: Core infrastructure that MUST be complete before ANY user story can be implemented

**âš ï¸ CRITICAL**: No user story work can begin until this phase is complete

### Backend Foundation

- [ ] T008 Create LLMProvider protocol in server/server/domain/llm_provider.py (DIP abstraction per Article IV)
- [ ] T009 Implement InstructorLLMProvider in server/server/infrastructure/llm/instructor_provider.py (concrete implementation with OpenAI client, constructor injection)
- [ ] T010 [P] Create InterventionRequest Pydantic model in server/server/domain/models/intervention.py (matches OpenAPI contract)
- [ ] T011 [P] Create InterventionResponse Pydantic model in server/server/domain/models/intervention.py (includes action, content, lock_id, anchor, action_id)
- [ ] T012 [P] Create Anchor union type (AnchorPos | AnchorRange | AnchorLockId) in server/server/domain/models/anchor.py
- [ ] T013 Implement idempotency cache manager in server/server/infrastructure/cache/idempotency_cache.py (15-second TTL, in-memory for P1)

### Frontend Foundation

- [ ] T014 Create Milkdown editor wrapper component in client/src/components/Editor/EditorCore.tsx (basic setup with preset-commonmark)
- [ ] T015 [P] Create TypeScript types for LockBlock in client/src/types/lock.ts (lock_id, content, source, created_at, is_deletable)
- [ ] T016 [P] Create TypeScript types for WritingState enum in client/src/types/state.ts (WRITING | IDLE | STUCK)
- [ ] T017 [P] Create TypeScript types for AgentMode enum in client/src/types/mode.ts (muse | loki | off)
- [ ] T018 Create API client wrapper in client/src/services/api/interventionClient.ts (uses generated types, handles Idempotency-Key header)

**Checkpoint**: Foundation ready - user story implementation can now begin in parallel

---

## Phase 3: User Story 1 - Un-deletable Constraint Enforcement (Priority: P1) ðŸŽ¯ MVP CORE

**Goal**: Implement editor-level transaction filtering to prevent deletion/modification of blocks with lock_id attribute

**Independent Test**: 
1. Inject a locked block with lock_id into editor
2. Attempt to delete using Backspace/Delete/Ctrl+A+Delete
3. Verify block remains intact (100% success rate)
4. Attempt Undo operation on AI-injected Delete action
5. Verify deletion cannot be undone

**Why P1**: This is the ONLY P1 feature per Article II (Vibe-First Imperative) - the core product differentiation

---

### Tests for User Story 1 (MANDATORY - Article III: TDD) âœ…

> **CONSTITUTIONAL REQUIREMENT**: Write these tests FIRST, ensure they FAIL, then implement (Red-Green-Refactor)

#### Backend Tests (API Contract)

- [ ] T019 [P] [US1] Write contract test for POST /impetus/generate-intervention in server/tests/test_intervention_api.py:
  - Test valid Muse mode request returns provoke action with lock_id
  - Test valid Loki mode request returns provoke or delete action
  - Test idempotency: same Idempotency-Key returns cached response
  - Test 400 for out-of-bounds anchor
  - Test 422 for invalid mode value
  - Include Google-style docstrings per Article V
  - **Expected**: All tests FAIL (endpoint not implemented yet)

#### Frontend Tests (Lock Enforcement)

- [ ] T020 [P] [US1] Write E2E test for lock enforcement in client/tests/e2e/lock-enforcement.spec.ts (Playwright):
  - Test: Inject locked block, try Backspace â†’ verify block persists + shake animation + bonk sound
  - Test: Inject locked block, try Delete key â†’ verify block persists
  - Test: Inject locked block, try Ctrl+A then Delete â†’ verify only non-locked content deleted
  - Test: Inject locked block, try selecting and replacing â†’ verify replacement blocked
  - Include JSDoc comments per Article V
  - **Expected**: All tests FAIL (filterTransaction not implemented yet)

- [ ] T021 [P] [US1] Write E2E test for Undo bypass in client/tests/e2e/undo-bypass.spec.ts (Playwright):
  - Test: Simulate AI Delete action (bypass Undo stack), try Ctrl+Z â†’ verify deletion cannot be undone
  - Test: User types text, then Ctrl+Z â†’ verify normal Undo still works (only AI actions bypass)
  - **Expected**: All tests FAIL (Undo bypass not implemented yet)

- [ ] T022 [P] [US1] Write unit test for LockManager in client/tests/unit/LockManager.test.ts (Vitest):
  - Test: applyLock() adds lock_id to set
  - Test: removeLock() removes lock_id from set
  - Test: hasLock() returns true for existing lock
  - Test: extractLocksFromMarkdown() parses `<!-- lock:xxx -->` comments correctly
  - Target â‰¥80% coverage per Article III
  - **Expected**: All tests FAIL (LockManager not implemented yet)

#### Verification Step

- [ ] T023 [US1] Run tests to verify RED state: `cd server && poetry run pytest tests/test_intervention_api.py -v` (should FAIL)
- [ ] T024 [US1] Run tests to verify RED state: `cd client && npm run test:e2e -- lock-enforcement.spec.ts` (should FAIL)
- [ ] T025 [US1] Run tests to verify RED state: `cd client && npm run test` (should FAIL on LockManager tests)

---

### Implementation for User Story 1

#### Backend Implementation (API + Service Layer)

- [ ] T026 [US1] Implement InterventionService in server/server/application/services/intervention_service.py:
  - Constructor injection of LLMProvider (DIP per Article IV)
  - Method: generate_intervention(request: InterventionRequest) â†’ InterventionResponse
  - Delegate to LLM provider for decision-making
  - Apply safety guard: if doc length <50 chars, reject Delete action
  - Include Google-style docstrings with Args/Returns/Raises per Article V
  - **Dependency**: T008 (LLMProvider protocol), T009 (InstructorLLMProvider)

- [ ] T027 [US1] Implement POST /impetus/generate-intervention endpoint in server/server/api/routes/intervention.py:
  - Validate Idempotency-Key header (UUID format)
  - Validate X-Contract-Version header (must be "1.0.1")
  - Check idempotency cache before processing
  - Delegate to InterventionService (SRP per Article IV)
  - Handle errors: 400 (invalid anchor), 422 (validation), 429 (rate limit), 500 (LLM failure)
  - Cache successful responses for 15 seconds
  - Include endpoint docstring per Article V
  - **Dependency**: T026 (InterventionService), T013 (idempotency cache)

- [ ] T028 [US1] Register intervention route in server/server/api/main.py FastAPI app (register unversioned route)

#### Frontend Implementation (Lock Enforcement)

- [ ] T029 [P] [US1] Implement LockManager class in client/src/services/LockManager.ts:
  - Methods: applyLock(lockId), removeLock(lockId), hasLock(lockId), extractLocksFromMarkdown(markdown)
  - Persist locks to localStorage (key: `impetus-locks`)
  - Restore locks on page load
  - Include JSDoc for all public methods per Article V
  - **No dependencies** (can be developed in parallel)

- [ ] T030 [US1] Implement ProseMirror transaction filter in client/src/components/Editor/TransactionFilter.ts:
  - Export createLockFilter(lockedNodeIds: Set<string>) â†’ (tr: Transaction) => boolean
  - Detect ReplaceStep that affects locked nodes
  - Return false to block transaction
  - Trigger visual feedback (shake animation) and audio (bonk sound) on block
  - Include JSDoc for function and complex logic per Article V
  - **Dependency**: T029 (LockManager)

- [ ] T031 [US1] Integrate filterTransaction into Milkdown editor in client/src/components/Editor/EditorCore.tsx:
  - Use $view.create() to add filterTransaction plugin
  - Pass LockManager's locked set to createLockFilter
  - Include JSDoc for component per Article V
  - **Dependency**: T030 (TransactionFilter), T014 (EditorCore base)

- [ ] T032 [US1] Implement Undo bypass for AI Delete actions in client/src/services/api/interventionClient.ts:
  - When executing Delete action from API response, apply transaction with `setMeta('addToHistory', false)`
  - Manually manipulate ProseMirror state without Undo stack entry
  - Include JSDoc explaining Undo bypass mechanism per Article V
  - **Dependency**: T018 (API client wrapper)

- [ ] T033 [P] [US1] Implement lock persistence in client/src/services/LockPersistence.ts:
  - On document save: inject `<!-- lock:{lockId} -->` comments into Markdown
  - On document load: parse comments and restore locks via LockManager
  - Include JSDoc per Article V
  - **Dependency**: T029 (LockManager)

#### Visual/Audio Feedback (P2 - but included for completeness)

- [ ] T034 [P] [US1] Create shake animation component in client/src/components/Feedback/ShakeAnimation.tsx (Framer Motion):
  - Animate x: [0, -10, 10, -10, 10, 0] over 300ms
  - Trigger on delete attempt of locked block
  - Include JSDoc per Article V

- [ ] T035 [P] [US1] Create AudioPlayer service in client/src/services/AudioPlayer.ts:
  - Preload bonk.mp3, clank.mp3, whoosh.mp3 on mount
  - Export play(soundName) method
  - Include JSDoc per Article V

---

### Verification & Green State

- [ ] T036 [US1] Run backend tests to verify GREEN state: `cd server && poetry run pytest tests/test_intervention_api.py -v` (should PASS all tests from T019)
- [ ] T037 [US1] Run frontend E2E tests to verify GREEN state: `cd client && npm run test:e2e -- lock-enforcement.spec.ts` (should PASS all tests from T020)
- [ ] T038 [US1] Run frontend E2E tests to verify GREEN state: `cd client && npm run test:e2e -- undo-bypass.spec.ts` (should PASS all tests from T021)
- [ ] T039 [US1] Run frontend unit tests to verify GREEN state: `cd client && npm run test` (should PASS all LockManager tests from T022)
- [ ] T040 [US1] Verify test coverage for critical paths: `cd server && poetry run pytest --cov=server.application.services.intervention_service --cov-report=term-missing` (must be â‰¥80%)
- [ ] T041 [US1] Verify test coverage for critical paths: `cd client && npm run test -- --coverage LockManager TransactionFilter` (must be â‰¥80%)

---

### Refactor (TDD Cycle - Optional Improvements)

- [ ] T042 [US1] Refactor InterventionService to extract LLM prompt template into separate file (server/server/infrastructure/llm/prompts/intervention_prompt.py)
- [ ] T043 [US1] Refactor LockManager to use WeakMap for performance optimization (if needed based on profiling)
- [ ] T044 [US1] Re-run all tests after refactoring to ensure GREEN state maintained

---

### Act CLI Validation (User Story 1)

**CRITICAL**: User Story 1 is NOT complete until all Act CLI checks pass

- [ ] T045 [US1] Run Act CLI to simulate GitHub Actions CI pipeline: `act` (runs all 4 jobs: lint, type-check, backend-tests, frontend-tests)
- [ ] T046 [US1] Fix any linting issues identified by Act CLI: `act -j lint`
- [ ] T047 [US1] Fix any type-checking issues identified by Act CLI: `act -j type-check`
- [ ] T048 [US1] Fix any backend test failures identified by Act CLI: `act -j backend-tests`
- [ ] T049 [US1] Fix any frontend test failures identified by Act CLI: `act -j frontend-tests`
- [ ] T050 [US1] Verify Act CLI full workflow passes: `act` (all jobs must show âœ“)

**Checkpoint**: User Story 1 is fully functional, tested independently, and passes all CI checks via Act CLI

---

## Phase 4: User Story 2 - Muse Mode STUCK Detection and Intervention (Priority: P1)

**Goal**: Detect when user is idle for 60 seconds (STUCK state) and automatically trigger Muse intervention (provoke action with creative pressure)

**Independent Test**:
1. Start editor in Muse mode
2. Type a sentence, then stop typing
3. Wait 60 seconds (use accelerated timer in test)
4. Verify API call triggered with mode="muse"
5. Verify locked blockquote injected at cursor position

**Why P1**: Core Vibe feature - automatic intervention to break Mental Set

---

### Tests for User Story 2 (MANDATORY - Article III: TDD) âœ…

> **CONSTITUTIONAL REQUIREMENT**: Write these tests FIRST, ensure they FAIL, then implement (Red-Green-Refactor)

#### Frontend Tests (State Machine)

- [ ] T051 [P] [US2] Write unit test for useWritingState hook in client/tests/unit/useWritingState.test.ts (Vitest):
  - Test: User types â†’ state should be WRITING
  - Test: User stops typing for 5s â†’ state should transition to IDLE
  - Test: User stops typing for 60s â†’ state should transition to STUCK
  - Test: STUCK state triggers onStuck callback
  - Test: User resumes typing from STUCK â†’ state returns to WRITING
  - Test: State machine disabled when mode="off"
  - Target â‰¥95% accuracy per SC-002
  - Include JSDoc per Article V
  - **Expected**: All tests FAIL (useWritingState not implemented yet)

- [ ] T052 [P] [US2] Write E2E test for Muse intervention in client/tests/e2e/muse-intervention.spec.ts (Playwright):
  - Test: Type text, wait 60s â†’ verify API called with mode="muse" and last 3 sentences as context
  - Test: Verify locked block injected with correct lock_id
  - Test: Verify "Glitch" animation played on injection
  - Test: Verify "Clank" sound played on injection
  - Test: After injection, wait 60s again â†’ verify different content returned (no repetition)
  - **Expected**: All tests FAIL (state machine not implemented yet)

- [ ] T053 [P] [US2] Write unit test for context extraction in client/tests/unit/contextExtractor.test.ts (Vitest):
  - Test: Extract last 3 sentences from document
  - Test: Handle edge case: document has <3 sentences
  - Test: Handle edge case: cursor at beginning of document
  - **Expected**: All tests FAIL (context extractor not implemented yet)

#### Verification Step

- [ ] T054 [US2] Run tests to verify RED state: `cd client && npm run test -- useWritingState.test.ts` (should FAIL)
- [ ] T055 [US2] Run tests to verify RED state: `cd client && npm run test:e2e -- muse-intervention.spec.ts` (should FAIL)
- [ ] T056 [US2] Run tests to verify RED state: `cd client && npm run test -- contextExtractor.test.ts` (should FAIL)

---

### Implementation for User Story 2

#### Backend Implementation (LLM Integration)

- [ ] T057 [US2] Implement Muse mode LLM prompt in server/server/infrastructure/llm/prompts/muse_prompt.py:
  - System prompt: "You are a creative pressure agent. When the user is stuck, inject provocative narrative twists."
  - User prompt template with context variable
  - Return format: Pydantic InterventionResponse model
  - Include docstrings per Article V
  - **Dependency**: T026 (InterventionService already delegates to LLM)

- [ ] T058 [US2] Update InstructorLLMProvider to use Muse prompt in server/server/infrastructure/llm/instructor_provider.py:
  - Add mode-specific prompt selection logic
  - Validate LLM response against InterventionResponse Pydantic model
  - Include docstrings per Article V
  - **Dependency**: T057 (Muse prompt), T009 (InstructorLLMProvider base)

#### Frontend Implementation (State Machine + API Integration)

- [ ] T059 [P] [US2] Implement useWritingState hook in client/src/hooks/useWritingState.ts:
  - State machine: WRITING â†’ IDLE (5s) â†’ STUCK (60s)
  - Track lastInputTime with Date.now()
  - setInterval check every 1000ms
  - Trigger onStuck callback when transitioning to STUCK
  - Include JSDoc with state diagram per Article V
  - **No dependencies** (can be developed in parallel)

- [ ] T060 [P] [US2] Implement context extractor in client/src/services/contextExtractor.ts:
  - Extract last N sentences (default N=3) before cursor position
  - Handle edge cases: <N sentences, cursor at start
  - Include JSDoc per Article V
  - **No dependencies** (can be developed in parallel)

- [ ] T061 [US2] Integrate useWritingState into EditorCore component in client/src/components/Editor/EditorCore.tsx:
  - Import useWritingState hook
  - Pass mode prop (muse | loki | off)
  - Register onInput handler to update state machine
  - Register onStuck handler to trigger Muse intervention API call
  - Include JSDoc per Article V
  - **Dependency**: T059 (useWritingState hook), T031 (EditorCore with lock filter)

- [ ] T062 [US2] Implement Muse intervention trigger in client/src/services/api/interventionClient.ts:
  - Method: triggerMuseIntervention(context: string) â†’ Promise<InterventionResponse>
  - Generate Idempotency-Key (UUID v4)
  - Call POST /impetus/generate-intervention with mode="muse"
  - Extract context using contextExtractor
  - Include client_meta (doc_version, selection_from, selection_to)
  - Handle API errors gracefully (show user-friendly toast)
  - Include JSDoc per Article V
  - **Dependency**: T060 (context extractor), T018 (API client wrapper)

- [ ] T063 [US2] Implement content injection in client/src/services/ContentInjector.ts:
  - Method: injectLockedBlock(content: string, lockId: string, anchor: Anchor)
  - Insert content at anchor position
  - Apply lock_id to node attributes
  - Trigger "Glitch" animation + "Clank" sound
  - Include JSDoc per Article V
  - **Dependency**: T029 (LockManager), T034 (ShakeAnimation), T035 (AudioPlayer)

- [ ] T064 [US2] Wire Muse intervention end-to-end in client/src/components/Editor/EditorCore.tsx:
  - On STUCK state â†’ call triggerMuseIntervention
  - On API response â†’ call injectLockedBlock
  - Handle API failure â†’ reset to IDLE state
  - Include JSDoc per Article V
  - **Dependency**: T061 (useWritingState integration), T062 (Muse trigger), T063 (content injector)

---

### Verification & Green State

- [ ] T065 [US2] Run unit tests to verify GREEN state: `cd client && npm run test -- useWritingState.test.ts` (should PASS all tests from T051)
- [ ] T066 [US2] Run E2E tests to verify GREEN state: `cd client && npm run test:e2e -- muse-intervention.spec.ts` (should PASS all tests from T052)
- [ ] T067 [US2] Run unit tests to verify GREEN state: `cd client && npm run test -- contextExtractor.test.ts` (should PASS all tests from T053)
- [ ] T068 [US2] Verify STUCK detection accuracy: Manual test with 100 scenarios, success rate â‰¥95% per SC-002
- [ ] T069 [US2] Verify response time <3s: Performance monitoring with 100 interventions, P95 latency <3s per SC-003

---

### Refactor (TDD Cycle - Optional Improvements)

- [ ] T070 [US2] Refactor useWritingState to extract timer constants into config object (WRITING_THRESHOLD=5000, STUCK_THRESHOLD=60000)
- [ ] T071 [US2] Refactor contextExtractor to support configurable sentence count (default 3)
- [ ] T072 [US2] Re-run all tests after refactoring to ensure GREEN state maintained

---

### Act CLI Validation (User Story 2)

**CRITICAL**: User Story 2 is NOT complete until all Act CLI checks pass

- [ ] T073 [US2] Run Act CLI to simulate GitHub Actions CI pipeline: `act` (runs all 4 jobs: lint, type-check, backend-tests, frontend-tests)
- [ ] T074 [US2] Fix any linting issues identified by Act CLI: `act -j lint`
- [ ] T075 [US2] Fix any type-checking issues identified by Act CLI: `act -j type-check`
- [ ] T076 [US2] Fix any backend test failures identified by Act CLI: `act -j backend-tests`
- [ ] T077 [US2] Fix any frontend test failures identified by Act CLI: `act -j frontend-tests`
- [ ] T078 [US2] Verify Act CLI full workflow passes: `act` (all jobs must show âœ“)

**Checkpoint**: User Story 2 is fully functional, tested independently, and passes all CI checks via Act CLI

---

## Phase 5: User Story 3 - Loki Mode Random Chaos Interventions (Priority: P1)

**Goal**: Trigger random interventions (Provoke or Delete) at 30-120 second intervals, regardless of user typing state

**Independent Test**:
1. Start editor in Loki mode
2. Wait for random timer to trigger (use accelerated timer in test: 10-30s)
3. Verify API call with mode="loki"
4. Verify action executed (either Provoke with lock_id, or Delete with anchor)
5. Verify action cannot be undone

**Why P1**: Core Vibe feature - gamified discipline via unpredictable chaos

---

### Tests for User Story 3 (MANDATORY - Article III: TDD) âœ…

> **CONSTITUTIONAL REQUIREMENT**: Write these tests FIRST, ensure they FAIL, then implement (Red-Green-Refactor)

#### Frontend Tests (Random Timer + Actions)

- [ ] T079 [P] [US3] Write unit test for useLokiTimer hook in client/tests/unit/useLokiTimer.test.ts (Vitest):
  - Test: Random interval generated between 30-120 seconds (use crypto.getRandomValues)
  - Test: Timer triggers onTrigger callback at random interval
  - Test: After trigger, new random timer scheduled
  - Test: Timer disabled when mode != "loki"
  - Test: 1000 triggers follow uniform distribution (SC-004)
  - Include JSDoc per Article V
  - **Expected**: All tests FAIL (useLokiTimer not implemented yet)

- [ ] T080 [P] [US3] Write E2E test for Loki Provoke action in client/tests/e2e/loki-provoke.spec.ts (Playwright):
  - Test: Trigger Loki intervention â†’ API returns provoke action â†’ verify locked block injected
  - Test: Verify "Glitch" animation + "Clank" sound played
  - Test: Verify intervention happens even while user is typing (unlike Muse)
  - **Expected**: All tests FAIL (Loki timer not implemented yet)

- [ ] T081 [P] [US3] Write E2E test for Loki Delete action in client/tests/e2e/loki-delete.spec.ts (Playwright):
  - Test: Trigger Loki intervention â†’ API returns delete action â†’ verify text deleted at anchor range
  - Test: Verify deletion bypasses Undo stack (Ctrl+Z cannot restore)
  - Test: Verify fade-out animation + "Whoosh" sound played
  - Test: Safety guard: if doc <50 chars, backend refuses Delete (returns Provoke instead)
  - **Expected**: All tests FAIL (Delete action not implemented yet)

#### Backend Tests (Delete Action Logic)

- [ ] T082 [P] [US3] Write unit test for Loki mode logic in server/tests/test_loki_logic.py:
  - Test: Loki mode randomly selects Provoke or Delete
  - Test: Safety guard: doc length <50 chars â†’ force Provoke (reject Delete)
  - Test: Delete action includes valid anchor (range type with from < to)
  - Test: Provoke action includes lock_id and content
  - Include docstrings per Article V
  - **Expected**: All tests FAIL (Loki logic not implemented yet)

#### Verification Step

- [ ] T083 [US3] Run tests to verify RED state: `cd client && npm run test -- useLokiTimer.test.ts` (should FAIL)
- [ ] T084 [US3] Run tests to verify RED state: `cd client && npm run test:e2e -- loki-provoke.spec.ts` (should FAIL)
- [ ] T085 [US3] Run tests to verify RED state: `cd client && npm run test:e2e -- loki-delete.spec.ts` (should FAIL)
- [ ] T086 [US3] Run tests to verify RED state: `cd server && poetry run pytest tests/test_loki_logic.py -v` (should FAIL)

---

### Implementation for User Story 3

#### Backend Implementation (Loki Mode Decision Logic)

- [ ] T087 [US3] Implement Loki mode LLM prompt in server/server/infrastructure/llm/prompts/loki_prompt.py:
  - System prompt: "You are a chaos agent. Decide whether to provoke (inject) or delete (remove) to create unpredictable pressure."
  - Include randomness guidance for LLM
  - Return format: Pydantic InterventionResponse with action="provoke" or "delete"
  - Include docstrings per Article V
  - **Dependency**: T026 (InterventionService)

- [ ] T088 [US3] Update InstructorLLMProvider to use Loki prompt in server/server/infrastructure/llm/instructor_provider.py:
  - Add Loki-specific prompt selection
  - Validate LLM returns either Provoke (with content+lock_id) or Delete (with anchor)
  - Include docstrings per Article V
  - **Dependency**: T087 (Loki prompt), T058 (Muse prompt already added)

- [ ] T089 [US3] Implement safety guard in server/server/application/services/intervention_service.py:
  - Before returning Delete action, check doc length from client_meta
  - If length <50 chars, override action to Provoke
  - Include docstrings explaining safety guard per Article V
  - **Dependency**: T026 (InterventionService base)

#### Frontend Implementation (Random Timer + Delete Action)

- [ ] T090 [P] [US3] Implement useLokiTimer hook in client/src/hooks/useLokiTimer.ts:
  - Use crypto.getRandomValues() for uniform distribution
  - Generate random interval: min=30000ms, max=120000ms
  - Schedule setTimeout with recursive re-scheduling
  - Trigger onTrigger callback when timer fires
  - Include JSDoc with randomness algorithm per Article V
  - **No dependencies** (can be developed in parallel)

- [ ] T091 [US3] Integrate useLokiTimer into EditorCore component in client/src/components/Editor/EditorCore.tsx:
  - Import useLokiTimer hook
  - Register onTrigger handler to call Loki intervention API
  - Include JSDoc per Article V
  - **Dependency**: T090 (useLokiTimer hook), T064 (Muse integration already in EditorCore)

- [ ] T092 [US3] Implement Loki intervention trigger in client/src/services/api/interventionClient.ts:
  - Method: triggerLokiIntervention(context: string) â†’ Promise<InterventionResponse>
  - Generate Idempotency-Key (UUID v4)
  - Call POST /impetus/generate-intervention with mode="loki"
  - Include full document context (or last 10 sentences if >2000 chars)
  - Handle API errors gracefully
  - Include JSDoc per Article V
  - **Dependency**: T062 (Muse trigger for reference), T018 (API client wrapper)

- [ ] T093 [US3] Implement Delete action executor in client/src/services/DeleteExecutor.ts:
  - Method: executeDelete(anchor: Anchor) â†’ void
  - Validate anchor bounds (from < to, within doc length)
  - Create ProseMirror transaction with ReplaceStep
  - Apply with `setMeta('addToHistory', false)` to bypass Undo stack
  - Trigger fade-out animation + "Whoosh" sound
  - Include JSDoc explaining Undo bypass per Article V
  - **Dependency**: T032 (Undo bypass for reference)

- [ ] T094 [US3] Wire Loki intervention end-to-end in client/src/components/Editor/EditorCore.tsx:
  - On Loki timer trigger â†’ call triggerLokiIntervention
  - On API response â†’ check action type:
    - If "provoke": call injectLockedBlock (reuse from T063)
    - If "delete": call executeDelete (new from T093)
  - Handle API failure â†’ schedule next timer anyway
  - Include JSDoc per Article V
  - **Dependency**: T091 (useLokiTimer integration), T092 (Loki trigger), T093 (Delete executor)

---

### Verification & Green State

- [ ] T095 [US3] Run unit tests to verify GREEN state: `cd client && npm run test -- useLokiTimer.test.ts` (should PASS all tests from T079)
- [ ] T096 [US3] Run E2E tests to verify GREEN state: `cd client && npm run test:e2e -- loki-provoke.spec.ts` (should PASS all tests from T080)
- [ ] T097 [US3] Run E2E tests to verify GREEN state: `cd client && npm run test:e2e -- loki-delete.spec.ts` (should PASS all tests from T081)
- [ ] T098 [US3] Run backend tests to verify GREEN state: `cd server && poetry run pytest tests/test_loki_logic.py -v` (should PASS all tests from T082)
- [ ] T099 [US3] Verify random distribution: Statistical test with 1000 triggers, verify uniform distribution per SC-004
- [ ] T100 [US3] Verify intervention frequency: Measure average interventions per 5 minutes, should be â‰¥2 per SC-009

---

### Refactor (TDD Cycle - Optional Improvements)

- [ ] T101 [US3] Refactor useLokiTimer to extract random interval generator into separate utility function
- [ ] T102 [US3] Refactor DeleteExecutor to extract anchor validation into separate function
- [ ] T103 [US3] Re-run all tests after refactoring to ensure GREEN state maintained

---

### Act CLI Validation (User Story 3)

**CRITICAL**: User Story 3 is NOT complete until all Act CLI checks pass

- [ ] T104 [US3] Run Act CLI to simulate GitHub Actions CI pipeline: `act` (runs all 4 jobs: lint, type-check, backend-tests, frontend-tests)
- [ ] T105 [US3] Fix any linting issues identified by Act CLI: `act -j lint`
- [ ] T106 [US3] Fix any type-checking issues identified by Act CLI: `act -j type-check`
- [ ] T107 [US3] Fix any backend test failures identified by Act CLI: `act -j backend-tests`
- [ ] T108 [US3] Fix any frontend test failures identified by Act CLI: `act -j frontend-tests`
- [ ] T109 [US3] Verify Act CLI full workflow passes: `act` (all jobs must show âœ“)

**Checkpoint**: User Story 3 is fully functional, tested independently, and passes all CI checks via Act CLI. **P1 MVP is now complete (Lock + Muse + Loki)**

---

## Phase 6: User Story 4 - Manual Demo Trigger Button (Priority: P2)

**Goal**: Provide a "æˆ‘å¡ä½äº†ï¼" button that immediately triggers Muse intervention without waiting 60 seconds, for demo/testing purposes

**Independent Test**:
1. In Muse mode, click "æˆ‘å¡ä½äº†ï¼" button after typing for only 5 seconds
2. Verify Muse intervention triggered immediately (no 60s wait)
3. Verify STUCK timer reset to avoid double-trigger

**Why P2**: Auxiliary feature per Article II (not core Vibe)

---

### Tests for User Story 4 (OPTIONAL - P2 feature) âš ï¸

- [ ] T110 [P] [US4] Write E2E test for demo button in client/tests/e2e/demo-button.spec.ts (Playwright):
  - Test: In Muse mode, type text for 5s, click button â†’ verify intervention triggered
  - Test: In Loki mode, click button â†’ verify error message "Loki æ¨¡å¼ä¸æ”¯æŒæ‰‹åŠ¨è§¦å‘"
  - Test: After manual trigger, wait 60s â†’ verify STUCK timer reset (no double-trigger)
  - **Expected**: Tests FAIL (button not implemented yet)

#### Verification Step

- [ ] T111 [US4] Run tests to verify RED state: `cd client && npm run test:e2e -- demo-button.spec.ts` (should FAIL)

---

### Implementation for User Story 4

- [ ] T112 [P] [US4] Create DemoTrigger button component in client/src/components/Controls/DemoTrigger.tsx:
  - Button text: "æˆ‘å¡ä½äº†ï¼"
  - Disabled when mode="loki" (show tooltip: "Loki æ¨¡å¼ä¸æ”¯æŒæ‰‹åŠ¨è§¦å‘")
  - onClick â†’ trigger Muse intervention immediately
  - Include JSDoc per Article V
  - **No dependencies** (can be developed in parallel)

- [ ] T113 [US4] Update useWritingState hook to support manual trigger in client/src/hooks/useWritingState.ts:
  - Add manualTrigger() method that immediately sets state to STUCK and calls onStuck
  - Reset lastInputTime to prevent double-trigger
  - Include JSDoc per Article V
  - **Dependency**: T059 (useWritingState base)

- [ ] T114 [US4] Wire DemoTrigger button in EditorCore component in client/src/components/Editor/EditorCore.tsx:
  - Render DemoTrigger when mode="muse"
  - Pass manualTrigger handler from useWritingState
  - Include JSDoc per Article V
  - **Dependency**: T112 (DemoTrigger component), T113 (manualTrigger method)

---

### Verification & Green State

- [ ] T115 [US4] Run E2E tests to verify GREEN state: `cd client && npm run test:e2e -- demo-button.spec.ts` (should PASS all tests from T110)
- [ ] T116 [US4] Verify manual trigger response time <1s per SC-010

---

### Act CLI Validation (User Story 4)

- [ ] T117 [US4] Run Act CLI to simulate GitHub Actions CI pipeline: `act`
- [ ] T118 [US4] Fix any issues identified by Act CLI
- [ ] T119 [US4] Verify Act CLI full workflow passes: `act` (all jobs must show âœ“)

**Checkpoint**: User Story 4 complete

---

## Phase 7: User Story 5 - Visual and Audio Feedback (Priority: P2)

**Goal**: Provide rich sensory feedback (animations + sounds) for all Agent actions to enhance gameified experience

**Independent Test**:
1. Trigger Provoke action â†’ observe "Glitch" animation + "Clank" sound
2. Try deleting locked block â†’ observe "Shake" animation + "Bonk" sound
3. Trigger Delete action â†’ observe fade-out animation + "Whoosh" sound
4. Disable sound in settings â†’ verify animations play but no audio

**Why P2**: UI polish per Article II (not core Vibe)

---

### Tests for User Story 5 (OPTIONAL - P2 feature) âš ï¸

- [ ] T120 [P] [US5] Write E2E test for visual feedback in client/tests/e2e/visual-feedback.spec.ts (Playwright):
  - Test: Provoke action â†’ verify "Glitch" animation plays for 0.5s
  - Test: Delete attempt on lock â†’ verify "Shake" animation plays for 0.3s
  - Test: Delete action â†’ verify fade-out animation plays for 0.4s
  - Test: Animations maintain â‰¥30 FPS on low-end device simulation per SC-008
  - **Expected**: Tests FAIL (Framer Motion animations not implemented yet)

- [ ] T121 [P] [US5] Write E2E test for audio feedback in client/tests/e2e/audio-feedback.spec.ts (Playwright):
  - Test: Provoke action â†’ verify "Clank" sound plays
  - Test: Delete attempt on lock â†’ verify "Bonk" sound plays
  - Test: Delete action â†’ verify "Whoosh" sound plays
  - Test: Sound disabled in settings â†’ verify no audio plays
  - **Expected**: Tests FAIL (AudioPlayer not fully integrated yet)

#### Verification Step

- [ ] T122 [US5] Run tests to verify RED state: `cd client && npm run test:e2e -- visual-feedback.spec.ts` (should FAIL)
- [ ] T123 [US5] Run tests to verify RED state: `cd client && npm run test:e2e -- audio-feedback.spec.ts` (should FAIL)

---

### Implementation for User Story 5

#### Visual Feedback (Framer Motion Animations)

- [ ] T124 [P] [US5] Implement GlitchAnimation component in client/src/components/Feedback/GlitchAnimation.tsx:
  - Framer Motion keyframes: opacity flicker pattern over 500ms
  - GPU-accelerated (use transform, avoid layout shifts)
  - Include JSDoc per Article V
  - **Dependency**: T003 (Framer Motion installed)

- [ ] T125 [P] [US5] Enhance ShakeAnimation component in client/src/components/Feedback/ShakeAnimation.tsx:
  - Already created in T034, ensure GPU-accelerated
  - Verify â‰¥30 FPS on Chrome DevTools Performance panel
  - Include JSDoc per Article V
  - **Dependency**: T034 (ShakeAnimation base)

- [ ] T126 [P] [US5] Implement FadeOutAnimation component in client/src/components/Feedback/FadeOutAnimation.tsx:
  - Framer Motion: opacity 1 â†’ 0 over 400ms
  - GPU-accelerated
  - Include JSDoc per Article V
  - **Dependency**: T003 (Framer Motion installed)

#### Audio Feedback (Web Audio API)

- [ ] T127 [P] [US5] Download sound assets (<50KB each):
  - clank.mp3 (lock sound from Freesound.org)
  - bonk.mp3 (invalid action sound)
  - whoosh.mp3 (swipe sound)
  - Save to client/public/audio/

- [ ] T128 [US5] Enhance AudioPlayer service in client/src/services/AudioPlayer.ts:
  - Already created in T035, integrate with all actions
  - Add sound enable/disable setting
  - Preload all sounds on mount
  - Include JSDoc per Article V
  - **Dependency**: T035 (AudioPlayer base), T127 (sound assets)

#### Integration

- [ ] T129 [US5] Wire animations into ContentInjector in client/src/services/ContentInjector.ts:
  - Provoke action â†’ trigger GlitchAnimation
  - Include JSDoc per Article V
  - **Dependency**: T063 (ContentInjector base), T124 (GlitchAnimation)

- [ ] T130 [US5] Wire animations into TransactionFilter in client/src/components/Editor/TransactionFilter.ts:
  - Delete attempt on lock â†’ trigger ShakeAnimation
  - Include JSDoc per Article V
  - **Dependency**: T030 (TransactionFilter base), T125 (ShakeAnimation)

- [ ] T131 [US5] Wire animations into DeleteExecutor in client/src/services/DeleteExecutor.ts:
  - Delete action â†’ trigger FadeOutAnimation
  - Include JSDoc per Article V
  - **Dependency**: T093 (DeleteExecutor base), T126 (FadeOutAnimation)

- [ ] T132 [US5] Wire AudioPlayer into all action triggers:
  - Provoke â†’ play("clank")
  - Delete attempt on lock â†’ play("bonk")
  - Delete action â†’ play("whoosh")
  - Include JSDoc per Article V
  - **Dependency**: T128 (AudioPlayer enhanced)

---

### Verification & Green State

- [ ] T133 [US5] Run E2E tests to verify GREEN state: `cd client && npm run test:e2e -- visual-feedback.spec.ts` (should PASS all tests from T120)
- [ ] T134 [US5] Run E2E tests to verify GREEN state: `cd client && npm run test:e2e -- audio-feedback.spec.ts` (should PASS all tests from T121)
- [ ] T135 [US5] Verify animation FPS â‰¥30 on low-end device simulation per SC-008

---

### Act CLI Validation (User Story 5)

- [ ] T136 [US5] Run Act CLI to simulate GitHub Actions CI pipeline: `act`
- [ ] T137 [US5] Fix any issues identified by Act CLI
- [ ] T138 [US5] Verify Act CLI full workflow passes: `act` (all jobs must show âœ“)

**Checkpoint**: User Story 5 complete, all P2 features delivered

---

## Phase 8: Polish & Cross-Cutting Concerns

**Purpose**: Final quality improvements and documentation

- [ ] T139 [P] Update README.md with Muse/Loki usage instructions (already done, verify completeness)
- [ ] T140 [P] Update API_CONTRACT.md with final endpoint documentation (already done, verify accuracy)
- [ ] T141 [P] Add error recovery guide to quickstart.md (API failure handling, network issues)
- [ ] T142 Code cleanup: Remove console.log statements, unused imports
- [ ] T143 [P] Performance optimization: Profile and optimize critical paths if needed
- [ ] T144 [P] Security review: Verify no secrets in code, validate all user inputs
- [ ] T145 Accessibility audit: Verify keyboard navigation works for all controls
- [ ] T146 [P] Add JSDoc/docstrings to any remaining undocumented functions per Article V
- [ ] T147 Run full quickstart.md validation: Follow setup guide from scratch, verify all commands work

---

### Final Act CLI Validation (All Features)

**CRITICAL**: Project is NOT complete until full Act CLI validation passes for ALL features

- [ ] T148 Run Act CLI full workflow one final time: `act` (all 4 jobs must pass)
- [ ] T149 Verify Act CLI lint job passes: `act -j lint` (no warnings or errors)
- [ ] T150 Verify Act CLI type-check job passes: `act -j type-check` (no type errors)
- [ ] T151 Verify Act CLI backend-tests job passes: `act -j backend-tests` (all tests green)
- [ ] T152 Verify Act CLI frontend-tests job passes: `act -j frontend-tests` (all tests green, including E2E)
- [ ] T153 Generate test coverage report: `cd server && poetry run pytest --cov=server --cov-report=html` (verify â‰¥80% for critical paths)
- [ ] T154 Generate test coverage report: `cd client && npm run test -- --coverage` (verify â‰¥80% for critical paths)
- [ ] T155 Final Act CLI validation with verbose output: `act -v` (capture full logs for documentation)

**Checkpoint**: All features complete, all tests passing, all CI checks green via Act CLI

---

## Dependencies & Execution Order

### Phase Dependencies

- **Setup (Phase 1)**: No dependencies - can start immediately
- **Foundational (Phase 2)**: Depends on Setup completion - BLOCKS all user stories
- **User Stories (Phase 3-7)**: All depend on Foundational phase completion
  - User Story 1 (Lock): Can start after Foundational (Phase 2)
  - User Story 2 (Muse): Can start after Foundational, integrates with US1 lock mechanism
  - User Story 3 (Loki): Can start after Foundational, integrates with US1 lock mechanism
  - User Story 4 (Demo): Can start after US2 (Muse) complete
  - User Story 5 (Vibe): Can start after US1/US2/US3 complete (provides feedback for all)
- **Polish (Phase 8)**: Depends on all desired user stories being complete

### User Story Dependencies

- **User Story 1 (P1 - Lock)**: Can start after Foundational (Phase 2) - No dependencies on other stories
- **User Story 2 (P1 - Muse)**: Can start after Foundational - Integrates with US1 lock mechanism but independently testable
- **User Story 3 (P1 - Loki)**: Can start after Foundational - Integrates with US1 lock mechanism but independently testable
- **User Story 4 (P2 - Demo)**: Depends on US2 (Muse) - Triggers Muse intervention manually
- **User Story 5 (P2 - Vibe)**: Depends on US1/US2/US3 - Provides feedback for all actions

### Within Each User Story (TDD Cycle - NON-NEGOTIABLE per Article III)

1. **RED Phase**: Write tests first, verify they FAIL
2. **GREEN Phase**: Implement minimal code to make tests PASS
3. **REFACTOR Phase**: Improve code while keeping tests green
4. **ACT CLI Validation**: Verify all CI checks pass before marking story complete

**Execution Order Within Story**:
- Tests (all tests can be written in parallel)
- Models (can be developed in parallel if independent)
- Services (depend on models, use constructor injection per Article IV)
- Endpoints/UI (depend on services, delegate per Article IV SRP)
- Integration
- Act CLI validation

### Parallel Opportunities

- **Setup Phase**: T001, T002, T003, T004, T006 can run in parallel
- **Foundational Phase**: Backend (T008-T013) and Frontend (T014-T018) can run in parallel
- **User Story 1 Tests**: T019, T020, T021, T022 can all be written in parallel (RED phase)
- **User Story 1 Implementation**: T029 (LockManager), T034 (ShakeAnimation), T035 (AudioPlayer) can run in parallel
- **User Story 2 Tests**: T051, T052, T053 can all be written in parallel
- **User Story 2 Implementation**: T059 (useWritingState), T060 (context extractor) can run in parallel
- **User Story 3 Tests**: T079, T080, T081, T082 can all be written in parallel
- **User Story 3 Implementation**: T090 (useLokiTimer) can develop in parallel with other tasks
- **Different User Stories**: Once Foundational complete, US1, US2, US3 can be worked on in parallel by different developers
- **Polish Phase**: T139, T140, T141, T143, T144, T146 can run in parallel

---

## Parallel Example: User Story 1 (Lock Enforcement)

### RED Phase (All tests written in parallel)
```bash
# Launch all tests together:
Task T019: Contract test for intervention endpoint
Task T020: E2E test for lock enforcement
Task T021: E2E test for Undo bypass
Task T022: Unit test for LockManager
# Result: All tests FAIL (expected)
```

### GREEN Phase (Implementation with dependencies)
```bash
# Parallel: Foundation
Task T029: LockManager class (no deps)
Task T034: ShakeAnimation component (no deps)
Task T035: AudioPlayer service (no deps)

# Sequential: Transaction filter (depends on T029)
Task T030: TransactionFilter (uses LockManager)

# Sequential: Editor integration (depends on T030)
Task T031: Integrate filterTransaction into EditorCore

# Sequential: Undo bypass (depends on API client)
Task T032: Implement Undo bypass

# Parallel: Lock persistence (depends on T029)
Task T033: Lock persistence with Markdown comments
```

### REFACTOR Phase
```bash
Task T042-T044: Refactor and re-test
```

### ACT CLI Validation
```bash
Task T045-T050: Act CLI full pipeline validation
# Result: All jobs PASS (required for completion)
```

---

## Implementation Strategy

### MVP First (P1 Only: Lock + Muse + Loki)

1. Complete Phase 1: Setup
2. Complete Phase 2: Foundational (CRITICAL - blocks all stories)
3. Complete Phase 3: User Story 1 (Lock) â†’ **Test independently with Act CLI**
4. Complete Phase 4: User Story 2 (Muse) â†’ **Test independently with Act CLI**
5. Complete Phase 5: User Story 3 (Loki) â†’ **Test independently with Act CLI**
6. **STOP and VALIDATE**: Run full Act CLI pipeline for P1 MVP
7. Deploy/demo if ready

**Total P1 Tasks**: T001-T109 (109 tasks for core Vibe)

### Full Delivery (P1 + P2)

1. Complete P1 MVP (above)
2. Complete Phase 6: User Story 4 (Demo) â†’ **Test independently with Act CLI**
3. Complete Phase 7: User Story 5 (Vibe) â†’ **Test independently with Act CLI**
4. Complete Phase 8: Polish & Cross-Cutting Concerns
5. **Final Act CLI Validation**: T148-T155 (all features)

**Total Tasks**: T001-T155 (155 tasks for complete feature)

### Incremental Delivery

1. Complete Setup + Foundational â†’ Foundation ready
2. Add User Story 1 â†’ Test with Act CLI â†’ Deploy/Demo (Lock enforcement working!)
3. Add User Story 2 â†’ Test with Act CLI â†’ Deploy/Demo (Muse mode added!)
4. Add User Story 3 â†’ Test with Act CLI â†’ Deploy/Demo (MVP complete with Loki!)
5. Add User Story 4 â†’ Test with Act CLI â†’ Deploy/Demo (Demo button added)
6. Add User Story 5 â†’ Test with Act CLI â†’ Deploy/Demo (Full Vibe experience!)
7. Polish â†’ Final Act CLI validation â†’ Production ready

### Parallel Team Strategy

With 3 developers after Foundational phase completes:

- **Developer A**: User Story 1 (Lock) â†’ T019-T050 (32 tasks)
- **Developer B**: User Story 2 (Muse) â†’ T051-T078 (28 tasks)
- **Developer C**: User Story 3 (Loki) â†’ T079-T109 (31 tasks)

Each developer follows TDD cycle independently, all stories integrate via Foundational layer.

---

## Task Summary

| Phase | User Story | Priority | Task Range | Count | Act CLI Required |
|-------|------------|----------|------------|-------|------------------|
| 1 | Setup | - | T001-T007 | 7 | No (prep only) |
| 2 | Foundational | - | T008-T018 | 11 | No (foundation) |
| 3 | US1 - Lock Enforcement | **P1** | T019-T050 | 32 | **Yes** (T045-T050) |
| 4 | US2 - Muse STUCK Detection | **P1** | T051-T078 | 28 | **Yes** (T073-T078) |
| 5 | US3 - Loki Random Chaos | **P1** | T079-T109 | 31 | **Yes** (T104-T109) |
| 6 | US4 - Demo Button | P2 | T110-T119 | 10 | Yes (T117-T119) |
| 7 | US5 - Visual/Audio Feedback | P2 | T120-T138 | 19 | Yes (T136-T138) |
| 8 | Polish & Cross-Cutting | - | T139-T155 | 17 | **Yes** (T148-T155) |

**Total Tasks**: 155  
**P1 MVP Tasks**: T001-T109 (109 tasks)  
**P2 Enhancement Tasks**: T110-T138 (29 tasks)  
**Polish Tasks**: T139-T155 (17 tasks)

**Parallel Opportunities**: ~35% of tasks marked [P] (can run in parallel within phase)

**Independent Test Criteria Met**: Each user story has clear test criteria and Act CLI validation gates

**Act CLI Validation Gates**: 6 checkpoints (US1, US2, US3, US4, US5, Final)

---

## Notes

- **[P] tasks** = Different files, no dependencies, can run in parallel
- **[Story] label** = Maps task to specific user story for traceability
- **Act CLI Requirement**: All user stories marked incomplete until `act` passes all CI checks
- **TDD Cycle Mandatory**: RED â†’ GREEN â†’ REFACTOR â†’ ACT CLI for all P1 features per Article III
- **Each user story independently completable and testable**
- **Verify tests FAIL before implementing** (RED phase)
- **Commit after each task or logical group**
- **Stop at any checkpoint to validate story independently with Act CLI**
- **Avoid**: Vague tasks, same file conflicts, cross-story dependencies that break independence
- **Sound assets**: Download from Freesound.org (CC0 licensed, <50KB each)
- **Animation performance**: Use Chrome DevTools Performance panel to verify â‰¥30 FPS
- **Constitution compliance**: All tasks include documentation requirements per Article V
